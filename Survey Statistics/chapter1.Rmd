---
title_meta  : Chapter 1
title       : Survey Statistics
description : Introduction to Survey Statistics

---type:NormalExercise xp:100

## Welcome to an introduction to Survey Statistics

In this course you will learn methods frequently used to manage and analyze survey data. Survey data is used in a variety of fields including Public Health, Economics, Political Science, and Data Science. The US Census, the National Health Interview Survey, The National Health and Nutrition Examination Survey, The California Health Interview Survey, Nielsen Ratings, and Election Polling are some examples of survey datasets. 

R is well suited to handle survey statistics using the "survey" package developed by Thomas Lumley. Lumley's book *Complex Surveys: A Guide to Analysis Using R* is the main resource for this course, and it is highly recommended.



*** =instructions
- Run the code that installs and loads the survey package.


*** =sample_code
```{r,eval=FALSE}
install.packages("survey")
library("survey")
```

*** =sct
```{r,eval=FALSE}
# The Submission Correctness Test code
# It takes as input the students workspace, his code and what was printed to the console during the exercise.
# Based on these inputs the SCT returns:
# (i) whether the students code was correct
# (ii) a message to the student to either help him find what was wrong or congratulate him on finding the solution.
success_msg("Well done! Continue!")
```

---type:MultipleChoiceExercise xp:100

## Random Samples

Suppose a school takes a random sample of test scores of their students, and wants to estimate the average score across the school's entire population.

Lets say their are $$1000$$ students at the school and we sample $200$ of them. Each student has an equal probability of being selected into the sample.

What is the probability, $$\pi_i$$, that any one student is sampled?

*** =instructions
- $$\frac{1}{4}$$
- $$\frac{1}{5}$$
- $$\frac{1}{2}$$
- $$\frac{1}{3}$$


*** =hint
What is 200 divided by 1000?


*** =sct
```{r,eval=FALSE}
msg1 = "Nope. Try again"
msg2 = "Well done!"

test_mc(correct = 2, feedback_msgs = c(msg1,msg2,msg1,msg1))
```
---type:NormalExercise xp:100

## Sampling Weights

One of the main concepts of survey statistics is sampling weights. The formula for sampling weights is 

$$ sampling weight=\frac{1}{\pi_i} $$ 

Where $$\pi_i$$ is the probability of person *i* being sampled.

Consider the example from the previous problem. Each student has a $$\pi_i=\frac{1}{5}$$ so the sampling weight equals $$5$$.

*** =instructions
-Already loaded is a dataset with the test scores of 200 students.
-Look at the first 5 rows and the structure of the dataset.
-Set the variable `{r} samplingWeight` equal to the correct value. 

*** =hint
If you don't remember the head and str functions use ?

*** =pre_exercise_code
```{r eval=FALSE}
schoolkids<-read.csv("childdata.csv")
```

*** =sample_code
```{r eval=FALSE}
# The dataframe schoolkids is already loaded
# Read the first five rows of schoolkids


# Read the structure of schoolkids


# Set samplingWeight equal to the sampling weight
samplingWeight<-_____

```

*** =solution
```{r eval=FALSE}
# The dataframe schoolkids is already loaded
# Read the first five rows of schoolkids
head(schoolkids)

# Read the structure of schoolkids
str(schoolkids)

# Set samplingWeight equal to the sampling weight
samplingWeight<-5

```

*** =sct
```{r eval=FALSE}
test_object(head(schoolkids), 
            undefined_msg = "Please make sure to print the first 5 rows",
            incorrect_msg = "Please make sure to print the first 5 rows")
test_object(str(schoolkids), undefined_msg="Please look at the structure of the dataset.",
            incorrect_msg="Please look at the structure of the dataset.")
test_object(samplingWeight<-5, undefined_msg="Please assign a value to samplingWeight.",
            incorrect_msg="Did you assign the correct value to samplingWeight?")
success_msg("Great! Head over to the next exercise.")
```
---type:NormalExercise xp:100

## Horvits-Thompson Estimator

The Horvits-Thompson estimator approximates the population total by summing the weighted observations. Continueing with the previous example, the formula for the Horvits-Thompson estimator of total student test scores is

$$E[T_{score}]=\sum\limits_{i=1}^N \frac{1}{\pi_i} * score_i * \pi_i=\sum\limits_{i=1}^N score_i= T_{score}$$

*** =instructions
-Add a variable to the dataset named `{r}samplingweight` that is equal to the `{r}samplingweight` variable you created in the last exercise.

-Using the Horvits-Thompson Estimator, predict the total number of boys and girls at the school.

*** =hint
The Horvits-Thompson Estimator formula in *R* code looks like `{r} samplingWeight*sum(x)`

*** =pre_exercise_code
```{r eval=FALSE}
schoolkids<-read.csv("childdata.csv")
samplingWeight<-5
```

*** =sample_code
```{r eval=FALSE}
# The dataframe schoolkids is already loaded
# The variable samplingWeight is already loaded

# Create a new variable in schoolkids equal to samplingWeight
schoolkids$samplingWeight<-_____

# Assign the sum of the students' scores multiplied by their weights
totalMales<-_____
totalFemales<-_____
#Print out the results


```

*** =solution
```{r eval=FALSE}
# The dataframe schoolkids is already loaded
# The variable samplingWeight is already loaded

# Create a new variable in schoolkids equal to samplingWeight
schoolkids$samplingWeight<-samplingWeight

# Assign the sum of the students' scores multiplied by their weights
totalMales<-samplingWeight*sum(schoolkids$gender=="Male")
totalFemales<-samplingWeight*sum(schoolkids$gender=="Female")
# Print out the results
totalMales
totalFemales

```

*** =sct
```{r eval=FALSE}
test_object(schoolkids$samplingWeight<-samplingWeight, 
            undefined_msg = "Did you assign a value to schoolkids$samplingWeight?",
            incorrect_msg = "Did you use samplingWeight?")
test_object(totalMales<-samplingWeight*sum(schoolkids$gender=="Male"), 
            undefined_msg = "Did you assign a value to totalMales?",
            incorrect_msg = "Did you use samplingWeight times the number of males in the sample?")
test_object(totalFemales<-samplingWeight*sum(schoolkids$gender=="Female"), 
            undefined_msg = "Did you assign a value to totalFemales?",
            incorrect_msg = "Did you use samplingWeight times the number of females in the sample?")
test_object(totalMales), 
            undefined_msg = "Did you print totalMales?",
            incorrect_msg = "Did you use samplingWeight times the number of males in the sample?")
test_object(totalFemales), 
            undefined_msg = "Did you print totalFemales?",
            incorrect_msg = "Did you use samplingWeight times the number of females in the sample?")
success_msg("Great! But remember that our result is just an estimate.")
```
---type:NormalExercise xp:100

## Variance of Horvits-Thompson Estimator

Keep in mind that the results from the previous exercise are purely estimates. Let's look at the variance so that we can get a sense of how good an estimate we have.

The formula for the variance of the Horvits-Thompson Estimator of a population total for a variable x from a random sample of n people from a population of N:

$$ var[T_x]=\frac{(N-n)}{N}*N^2*\frac{var(x)}{n} $$

*** =instructions
-Placeholder


*** =hint


*** =pre_exercise_code
```{r eval=FALSE}
schoolkids<-read.csv("childdata.csv")
samplingWeight<-5
```

*** =sample_code
```{r eval=FALSE}
# The dataframe schoolkids is already loaded
# The variable samplingWeight is already loaded


```

*** =solution
```{r eval=FALSE}
# The dataframe schoolkids is already loaded
# The variable samplingWeight is already loaded



```

*** =sct
```{r eval=FALSE}
test_object(schoolkids$samplingWeight<-samplingWeight, 
            undefined_msg = "Did you assign a value to schoolkids$samplingWeight?",
            incorrect_msg = "Did you use samplingWeight?")

success_msg("Great! ")
```




